#!/bin/bash

want=($(@ADMIN_PATH@/configgen -env @CONFIG_DIR@/@ENV_XML_FILE@ -list | awk 'BEGIN {FS="=|;";} !/dafilesrv/ {printf "%s@%s.service ", $2, $1;}'))
require=($(@ADMIN_PATH@/configgen -env @CONFIG_DIR@/@ENV_XML_FILE@ -list | awk 'BEGIN {FS="=|;";} /dafilesrv/ {printf "%s@%s.service", $2, $1;}'))

require_string=""
for a in "${wants[@]}"; do
	[[ ! -z "${want_string}" ]] && want_string="${want_string} "
	want_string="${want_string}${a}"
done

for a in "${requires[@]}"; do
	echo "${a}"
done

cat << EOT >> @INSTALL_DIR@/etc/systemd/system/hpccsystems-platform.target
[Unit]
Description=target alias for hpccsystems-platform
Requires=${require_string}
Wants=${want_string}

[Install]
Requires=${require_string}
Wants=${want_string}
EOT

ln -sf /etc/systemd/system/hpccsystems-platform.target @INSTALL_DIR@/etc/systemd/system/hpccsystems-platform.target
systemctl daemon-reload
