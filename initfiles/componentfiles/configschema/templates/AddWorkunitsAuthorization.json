{
    "name" : "Add workunits authorization",
    "description" : "Add the necessary keys for authorizing access to work units",
    "type" : "modification",
    "operations" : [
        {
            "action" : "create",
            "description" : "Create the AuthenticateFeature child key under Properties for all defined EspServices of type espsmc",
            "target_path" : "/Environment/Software/EspService[@buildSet=('espsmc')]/Properties",  <-- Selects all nodes in the path with the indicated buildSet attribute value
            "data" : {
                "node_type" : "AuthenticateFeature",                                              <-- Adds this key with attibutes as a chld node of all selected nodes
                "attributes" : [
                    {
                        "name" : "description",
                        "value" : "Access to deploy workunits"
                    },
                    {
                        "name" : "path",
                        "value" : "DeployWorkunitsAccess"
                    },
                    {
                        "name" : "resource",
                        "value" : "DeployWorkunitsAccess"
                    },
                    {
                        "name" : "service",
                        "value" : "ws_workunits"
                    }
                ]
            }
        },
        {
            "action" : "find",
            "description" : "Get all of the ECL watch defined service names",
            "target_path" : "/Environment/Software/EspService[@buildSet=('espsmc')]",             <-- Selects all nodes, like above, but not the Property node, the EspService node
            "data" : {
                "attributes" : [
                    {
                        "name" : "name",                                                          <-- Retrieves the attribute named "name" and saves the value in a variable named EclWatchName
                        "save" : {
                            "name" : "EclWatchName",
                            "duplicate_ok" : true                                                 <-- Allows multiple values to be saved (multple nodes are selected by target_path) into a value set
                        }
                    }
                ]
            }
        },
        {
            "action" : "create",
            "description" : "Add the AuthenticateFeature key to all ESP bindings for ECL Watch",
            "target_path" : "/Environment/Software/EspProcess/EspBinding[@service=('{{EclWatchName}}')]",   <-- select nodes with the EclWatch service name
            "data" : {
                "node_type" : "AuthenticateFeature",
                "attributes" : [
                    {
                        "name" : "description",
                        "value" : "Access to deploy workunits"
                    },
                    {
                        "name" : "path",
                        "value" : "DeployWorkunitsAccess"
                    },
                    {
                        "name" : "resource",
                        "value" : "DeployWorkunitsAccess"
                    },
                    {
                        "name" : "service",
                        "value" : "ws_workunits"
                    }
                ]
            }
        }
    ]
}
